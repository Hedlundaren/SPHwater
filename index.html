<!DOCTYPE html>
<html>
	<head>
		<title> Vatten </title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="style.css">

		<!--Bibliotek-->
		<script src="js/pixi.js"></script>
		<script src="js/math.min.js"></script>
		<script src="js/vectorLib.js"></script>
		<script src="js/sylvester.js"></script>
		<script src="js/functions.js"></script>
		<script src="kernels/kernels.js"></script>


	</head>

		<body>
			<div id="canvas"></div>

			<script>

				var FPS = 10;
				var wallPadding = 20; //pixels of wall padding to show wall interactions

				var width = window.innerWidth, height = window.innerHeight;
				var canvas = document.getElementById('canvas');
				var renderer = PIXI.autoDetectRenderer(width, height, canvas, true, true);
				var stage = new PIXI.Container();
				
				document.body.appendChild(renderer.view);


				var texture = PIXI.Texture.fromImage('images/purple_sprite.png');



				velocity = [Math.random()-0.5, Math.random()-0.5];

				parameters = {
				    'dt': 1.0 / FPS,
				    'mass': 1, 
				    'kernelSize': 1, 
				    'gasConstantK': 462,
				    'viscosityConstant': 0.001,
				    'restDensity': 1,
				    'sigma': 0.0072,
				    'nThreshold': 0.02,
				    'gravity': [5 -9.82], 
				    'leftBound': 0,
				    'rightBound': 100,
				    'bottomBound': 0, 
				    'topBound': 100,
				    'wallDamper': 0.6
				}
	
			
				var particles = [];
				for(var i = 0; i < 30; i++){
					
					sprite = new PIXI.Sprite(texture);
					sprite.scale.x = 0.06;
					sprite.scale.y = 0.06;

					sprite.anchor.x = 0.5;
					sprite.anchor.y = 0.5;

					particle = {
					  'sprite' : sprite,
					  'position' : [Math.random()*width, Math.random()*height],
					  'velocity' : [Math.random()-0.5, Math.random()-0.5],
					  'density' : 1,
					  'pressure' : 1,
					  'force' : [0, 9.82],
					  'cs' : 0
					}

					particle.sprite.position.x = particle.position[0];
					particle.sprite.position.y = particle.position[1];

					stage.addChild(particle.sprite);
					particles.push(particle);

				}

				console.log(particles.length);


				document.addEventListener( 'mousedown', onDocumentMouseDown, false );
				window.addEventListener( 'resize', onWindowResize, false );


				function onDocumentMouseDown( event ) {

					mouseX = (event.clientX - window.innerWidth/2);
					mouseY = (event.clientY - window.innerHeight/2);

					var V = [mouseX,mouseY];
					console.log(V);

				}

				function onWindowResize( e ) {
					width = window.innerWidth, height = window.innerHeight;
					renderer.resize( width, height );
				}

				animate();

				first_time = Date.now();
				function animate() {

			   		var time = Date.now() / 1000;
				    requestAnimationFrame(animate);

				    calculateForces(particles, parameters);
				    performTimestep(particles, parameters.dt);

				    renderer.render(stage);
			   }

				
				
         				

			</script>
				

		
	</body>
</html>
